{
  "webhooks": [
    {
      "topic": "orders/create",
      "address": "https://breslevbooks.com/webhooks/orders/create",
      "format": "json",
      "description": "Déclenché à la création d'une commande",
      "actions": [
        "Envoyer email de confirmation",
        "Créer compte client si nouveau",
        "Générer watermark PDF pour livres numériques (LemonInk)",
        "Créer accès FlipHTML5 pour lecteur numérique",
        "Logger transaction dans analytics"
      ]
    },
    {
      "topic": "orders/paid",
      "address": "https://breslevbooks.com/webhooks/orders/paid",
      "format": "json",
      "description": "Déclenché quand le paiement est confirmé",
      "actions": [
        "Envoyer email avec liens de téléchargement",
        "Activer accès FlipHTML5",
        "Envoyer PDF watermarké via email",
        "Mettre à jour inventaire",
        "Déclencher fulfillment pour produits physiques",
        "Activer abonnement Sky Pilot si applicable"
      ]
    },
    {
      "topic": "orders/fulfilled",
      "address": "https://breslevbooks.com/webhooks/orders/fulfilled",
      "format": "json",
      "description": "Déclenché quand la commande est expédiée",
      "actions": [
        "Envoyer email avec numéro de suivi",
        "Mettre à jour statut dans customer account",
        "Notifier client via WhatsApp si activé"
      ]
    },
    {
      "topic": "orders/cancelled",
      "address": "https://breslevbooks.com/webhooks/orders/cancelled",
      "format": "json",
      "description": "Déclenché en cas d'annulation",
      "actions": [
        "Révoquer accès FlipHTML5",
        "Désactiver liens de téléchargement",
        "Envoyer email de confirmation d'annulation",
        "Restaurer inventaire"
      ]
    },
    {
      "topic": "customers/create",
      "address": "https://breslevbooks.com/webhooks/customers/create",
      "format": "json",
      "description": "Déclenché à la création d'un compte client",
      "actions": [
        "Envoyer email de bienvenue",
        "Ajouter à newsletter si opted-in",
        "Créer profil dans FlipHTML5",
        "Envoyer code promo de bienvenue (optionnel)"
      ]
    },
    {
      "topic": "customers/update",
      "address": "https://breslevbooks.com/webhooks/customers/update",
      "format": "json",
      "description": "Déclenché lors de modification du profil",
      "actions": [
        "Synchroniser données avec FlipHTML5",
        "Mettre à jour préférences newsletter",
        "Logger changements pour analytics"
      ]
    },
    {
      "topic": "app/uninstalled",
      "address": "https://breslevbooks.com/webhooks/app/uninstalled",
      "format": "json",
      "description": "Déclenché si une app est désinstallée",
      "actions": [
        "Logger événement",
        "Nettoyer données associées",
        "Alerter admin"
      ]
    },
    {
      "topic": "products/create",
      "address": "https://breslevbooks.com/webhooks/products/create",
      "format": "json",
      "description": "Nouveau produit créé",
      "actions": [
        "Générer SEO metadata automatique",
        "Uploader vers FlipHTML5 si numérique",
        "Créer variantes par défaut"
      ]
    },
    {
      "topic": "products/update",
      "address": "https://breslevbooks.com/webhooks/products/update",
      "format": "json",
      "description": "Produit modifié",
      "actions": [
        "Mettre à jour cache",
        "Synchroniser avec FlipHTML5",
        "Régénérer sitemap si nécessaire"
      ]
    },
    {
      "topic": "inventory_levels/update",
      "address": "https://breslevbooks.com/webhooks/inventory/update",
      "format": "json",
      "description": "Stock modifié",
      "actions": [
        "Alerter si stock faible (<5)",
        "Mettre à jour affichage produit",
        "Désactiver produit si rupture"
      ]
    }
  ],
  "sky_pilot_webhooks": [
    {
      "event": "subscription.created",
      "description": "Nouvel abonnement créé",
      "actions": [
        "Activer accès à tous les livres numériques",
        "Créer compte FlipHTML5 Premium",
        "Envoyer email de bienvenue abonné",
        "Ajouter tag 'subscriber' au client"
      ]
    },
    {
      "event": "subscription.renewed",
      "description": "Abonnement renouvelé",
      "actions": [
        "Prolonger accès FlipHTML5",
        "Envoyer email de remerciement",
        "Offrir bonus de fidélité (optionnel)"
      ]
    },
    {
      "event": "subscription.cancelled",
      "description": "Abonnement annulé",
      "actions": [
        "Révoquer accès FlipHTML5 Premium",
        "Conserver accès aux achats individuels",
        "Envoyer email de feedback",
        "Offrir réduction pour réabonnement"
      ]
    },
    {
      "event": "subscription.payment_failed",
      "description": "Paiement d'abonnement échoué",
      "actions": [
        "Envoyer email de rappel",
        "Suspendre accès après 3 tentatives",
        "Proposer changement de moyen de paiement"
      ]
    }
  ],
  "custom_webhooks": [
    {
      "name": "Digital Book Access",
      "trigger": "order.paid AND product.type=digital",
      "actions": [
        "Generate unique FlipHTML5 reader link",
        "Create watermarked PDF with customer email",
        "Send access email with 24h expiry download link",
        "Log digital asset delivery"
      ]
    },
    {
      "name": "Bundle Purchase",
      "trigger": "product.type=bundle",
      "actions": [
        "Unbundle items and create individual access",
        "Apply bundle discount",
        "Create separate download links for each item",
        "Track bundle analytics"
      ]
    },
    {
      "name": "Free Shipping Notification",
      "trigger": "cart.total >= free_shipping_threshold",
      "actions": [
        "Display congratulations message",
        "Apply free shipping automatically",
        "Track conversion attribution"
      ]
    }
  ],
  "webhook_security": {
    "verification_method": "HMAC SHA256",
    "secret_key_location": "ENV: SHOPIFY_WEBHOOK_SECRET",
    "ip_whitelist": [
      "Shopify webhook IPs automatically whitelisted"
    ],
    "retry_policy": {
      "max_attempts": 19,
      "interval": "Exponential backoff",
      "timeout": "5 seconds"
    }
  },
  "webhook_logging": {
    "enabled": true,
    "log_level": "INFO",
    "retention_days": 30,
    "alert_on_failure": true,
    "alert_email": "admin@breslevbooks.com"
  }
}
